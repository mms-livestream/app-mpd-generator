/*jslint node: true */
/*jshint esversion: 6 */
"use strict";

function mpdGenerator() {
  let servers="";
  let id;

  for (let i = 0; i < arguments[1].length; i++) {
    id = arguments[0];
    servers += `<BaseURL>http://${arguments[1][i]}/api/description/${id}/</BaseURL> \n`;
  }

    
    let date = new Date();
    let hour = date.getHours() - 2;
    hour = (hour < 10 ? "0" : "") + hour;
    let min  = date.getMinutes();
    min = (min < 10 ? "0" : "") + min;
    let secAvailability  = date.getSeconds() + 0;//see for the time
    secAvailability = (secAvailability < 10 ? "0" : "") + secAvailability;
    let secPublish  = date.getSeconds() + 0; //see for the time
    secPublish = (secPublish < 10 ? "0" : "") + secPublish;
    
    let year = date.getFullYear();
    let month = date.getMonth() + 1;
    month = (month < 10 ? "0" : "") + month;
    let day  = date.getDate();
    day = (day < 10 ? "0" : "") + day;

    let availabilityStartTime = year + "-" + month + "-" + day + "T" + hour + ":" + min + ":" + secAvailability + ".000";
    //YYYY:MM:DD:HH:MM:SS
    let publishTime = year + "-" + month + "-" + day + "T" + hour + ":" + min + ":" + secPublish + ".000";


    let mpd =
    
`<?xml version="1.0"?>
<MPD xmlns="urn:mpeg:dash:schema:mpd:2011" minBufferTime="PT1.500S" type="dynamic" availabilityStartTime="${availabilityStartTime}" publishTime="${publishTime}" maxSegmentDuration="PT0H0M6.000S" minimumUpdatePeriod="P0Y0M0DT0H10M30.000S" profiles="urn:mpeg:dash:profile:isoff-live:2011" GOP="12" numberOfServers="1">
<ProgramInformation moreInformationURL="http://gpac.sourceforge.net">
<Title>mpd.mpd generated by GPAC</Title>
</ProgramInformation>
<Period id="p0" start="P0Y0M0DT0H0M0.000S">

<AdaptationSet segmentAlignment="true" maxWidth="640" maxHeight="480" maxFrameRate="24" par="16:9" lang="und">

${servers}

<SegmentTemplate timescale="12288" media="$Bandwidth$/out$Bandwidth$_dash$Number$.m4s" startNumber="2" duration="98304" initialization="$Bandwidth$/out$Bandwidth$_dash.mp4"/>
<Representation id="1" mimeType="video/mp4" codecs="avc1.4d4028" width="640" height="480" frameRate="24" sar="4:3" startWithSAP="1" bandwidth="500000"></Representation>
<Representation id="2" mimeType="video/mp4" codecs="avc1.4d4028" width="640" height="480" frameRate="24" sar="4:3" startWithSAP="1" bandwidth="1000000"></Representation>
<Representation id="3" mimeType="video/mp4" codecs="avc1.4d4028" width="640" height="480" frameRate="24" sar="4:3" startWithSAP="1" bandwidth="2000000"></Representation>
</AdaptationSet>
</Period>
</MPD> `
      

 // return console.log(mpd);
 return mpd;
}

mpdGenerator(2, ["192.25", "1356.45"]);
